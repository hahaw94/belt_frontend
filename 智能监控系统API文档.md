# ğŸ“– æ™ºèƒ½ç›‘æ§ç³»ç»ŸAPIæ¥å£æ–‡æ¡£

## 1. ç”¨æˆ·è®¤è¯ä¸ç®¡ç†

### 1.1 ç”¨æˆ·ç™»å½•

**æ¥å£åç§°ï¼š** ç”¨æˆ·ç™»å½•éªŒè¯
**åŠŸèƒ½æè¿°ï¼š** ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿï¼Œè¿”å›è®¤è¯ä»¤ç‰Œ
**æ¥å£åœ°å€ï¼š** /api/auth/login
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### åŠŸèƒ½è¯´æ˜
éªŒè¯ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼ŒæˆåŠŸåè¿”å›JWTä»¤ç‰Œç”¨äºåç»­APIè°ƒç”¨çš„èº«ä»½éªŒè¯ã€‚

```mermaid
sequenceDiagram
    participant Client
    participant Server
    participant Database
    Client->>Server: æäº¤ç™»å½•ä¿¡æ¯
    Server->>Database: éªŒè¯ç”¨æˆ·å‡­æ®
    Database-->>Server: è¿”å›ç”¨æˆ·ä¿¡æ¯
    Server-->>Client: è¿”å›ä»¤ç‰Œå’Œç”¨æˆ·ä¿¡æ¯
```

#### è¯·æ±‚å‚æ•°
```json
{
  "username": "admin",
  "password": "123456"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| username | string | æ˜¯ | ç”¨æˆ·å | admin |
| password | string | æ˜¯ | å¯†ç  | 123456 |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_info": {
      "id": 1,
      "username": "admin",
      "role": "ç®¡ç†å‘˜",
      "permissions": ["UserManagement", "DeviceManagement"],
      "last_login": "2024-01-20 10:30:00"
    }
  },
  "message": "ç™»å½•æˆåŠŸ",
  "success": true
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| error | int | æ˜¯ | é”™è¯¯ç  | 0 |
| body | object | æ˜¯ | å“åº”æ•°æ® | |
| body.token | string | æ˜¯ | JWTè®¤è¯ä»¤ç‰Œ | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |
| body.user_info | object | æ˜¯ | ç”¨æˆ·ä¿¡æ¯ | |
| body.user_info.id | int | æ˜¯ | ç”¨æˆ·ID | 1 |
| body.user_info.username | string | æ˜¯ | ç”¨æˆ·å | admin |
| body.user_info.role | string | æ˜¯ | ç”¨æˆ·è§’è‰² | ç®¡ç†å‘˜ |
| body.user_info.permissions | array | æ˜¯ | ç”¨æˆ·æƒé™åˆ—è¡¨ | ["UserManagement"] |
| body.user_info.last_login | string | æ˜¯ | ä¸Šæ¬¡ç™»å½•æ—¶é—´ | 2024-01-20 10:30:00 |
| message | string | æ˜¯ | å“åº”æ¶ˆæ¯ | ç™»å½•æˆåŠŸ |
| success | bool | æ˜¯ | æ˜¯å¦æˆåŠŸ | true |

### 1.2 è·å–ç”¨æˆ·åˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–ç”¨æˆ·åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** åˆ†é¡µè·å–ç³»ç»Ÿç”¨æˆ·åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰
**æ¥å£åœ°å€ï¼š** /api/users
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰ | 10 |
| username | string | å¦ | ç”¨æˆ·åç­›é€‰ | admin |
| role | string | å¦ | è§’è‰²ç­›é€‰ | ç®¡ç†å‘˜ |
| status | string | å¦ | çŠ¶æ€ç­›é€‰ | å¯ç”¨ |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "users": [
      {
        "id": 1,
        "username": "admin",
        "role": "ç®¡ç†å‘˜",
        "status": "å¯ç”¨",
        "permissions": ["UserManagement", "DeviceManagement"],
        "create_time": "2024-01-01 10:00:00",
        "last_login": "2024-01-20 10:30:00"
      }
    ],
    "total": 25,
    "page": 1,
    "page_size": 10
  },
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 1.3 æ·»åŠ ç”¨æˆ·

**æ¥å£åç§°ï¼š** æ·»åŠ æ–°ç”¨æˆ·
**åŠŸèƒ½æè¿°ï¼š** åˆ›å»ºæ–°çš„ç³»ç»Ÿç”¨æˆ·è´¦å·
**æ¥å£åœ°å€ï¼š** /api/users
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "username": "user01",
  "password": "123456",
  "role": "æ“ä½œå‘˜",
  "status": "å¯ç”¨",
  "permissions": ["DeviceManagement", "Detection"]
}
```

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "user_id": 26
  },
  "message": "ç”¨æˆ·æ·»åŠ æˆåŠŸ",
  "success": true
}
```

### 1.4 æ‰¹é‡æ·»åŠ ç”¨æˆ·

**æ¥å£åç§°ï¼š** æ‰¹é‡æ·»åŠ ç”¨æˆ·
**åŠŸèƒ½æè¿°ï¼š** é€šè¿‡Excelæ–‡ä»¶æ‰¹é‡åˆ›å»ºç”¨æˆ·è´¦å·
**æ¥å£åœ°å€ï¼š** /api/users/batch
**è¯·æ±‚æ–¹å¼ï¼š** POST
**Content-Typeï¼š** multipart/form-data

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| file | file | æ˜¯ | Excelç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ | users.xlsx |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "success_count": 10,
    "failed_count": 2,
    "failed_records": [
      {
        "row": 3,
        "username": "user03",
        "reason": "ç”¨æˆ·åå·²å­˜åœ¨"
      }
    ]
  },
  "message": "æ‰¹é‡æ·»åŠ ç”¨æˆ·å®Œæˆ",
  "success": true
}
```

### 1.5 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£åç§°ï¼š** æ›´æ–°ç”¨æˆ·ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** æ›´æ–°æŒ‡å®šç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œæƒé™
**æ¥å£åœ°å€ï¼š** /api/users/{user_id}
**è¯·æ±‚æ–¹å¼ï¼š** PUT

### 1.6 åˆ é™¤ç”¨æˆ·

**æ¥å£åç§°ï¼š** åˆ é™¤ç”¨æˆ·
**åŠŸèƒ½æè¿°ï¼š** åˆ é™¤æŒ‡å®šçš„ç”¨æˆ·è´¦å·
**æ¥å£åœ°å€ï¼š** /api/users/{user_id}
**è¯·æ±‚æ–¹å¼ï¼š** DELETE

### 1.7 é‡ç½®ç”¨æˆ·å¯†ç 

**æ¥å£åç§°ï¼š** é‡ç½®ç”¨æˆ·å¯†ç 
**åŠŸèƒ½æè¿°ï¼š** é‡ç½®æŒ‡å®šç”¨æˆ·çš„ç™»å½•å¯†ç 
**æ¥å£åœ°å€ï¼š** /api/users/{user_id}/reset-password
**è¯·æ±‚æ–¹å¼ï¼š** POST

### 1.8 è·å–è§’è‰²åˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–ç³»ç»Ÿè§’è‰²åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** è·å–ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„ç”¨æˆ·è§’è‰²
**æ¥å£åœ°å€ï¼š** /api/roles
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "roles": [
      {
        "id": 1,
        "name": "ç®¡ç†å‘˜",
        "description": "ç³»ç»Ÿç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™",
        "permissions": ["*"],
        "is_default": true
      },
      {
        "id": 2,
        "name": "æ“ä½œå‘˜",
        "description": "æ™®é€šæ“ä½œå‘˜ï¼Œå¯è‡ªå®šä¹‰æƒé™",
        "permissions": ["DeviceManagement", "Detection"],
        "is_default": true
      }
    ]
  },
  "message": "è·å–è§’è‰²åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 1.9 æ·»åŠ è§’è‰²

**æ¥å£åç§°ï¼š** æ·»åŠ è‡ªå®šä¹‰è§’è‰²
**åŠŸèƒ½æè¿°ï¼š** åˆ›å»ºæ–°çš„æ“ä½œå‘˜è§’è‰²å¹¶é…ç½®æƒé™
**æ¥å£åœ°å€ï¼š** /api/roles
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "name": "è®¾å¤‡ç®¡ç†å‘˜",
  "description": "ä¸“é—¨è´Ÿè´£è®¾å¤‡ç®¡ç†çš„æ“ä½œå‘˜",
  "permissions": ["DeviceManagement", "DeviceConfig", "AlgorithmConfig"]
}
```

### 1.10 æ›´æ–°è§’è‰²æƒé™

**æ¥å£åç§°ï¼š** æ›´æ–°è§’è‰²æƒé™
**åŠŸèƒ½æè¿°ï¼š** ä¿®æ”¹æŒ‡å®šè§’è‰²çš„æƒé™é…ç½®
**æ¥å£åœ°å€ï¼š** /api/roles/{role_id}
**è¯·æ±‚æ–¹å¼ï¼š** PUT

### 1.11 åˆ é™¤è§’è‰²

**æ¥å£åç§°ï¼š** åˆ é™¤è‡ªå®šä¹‰è§’è‰²
**åŠŸèƒ½æè¿°ï¼š** åˆ é™¤æŒ‡å®šçš„è‡ªå®šä¹‰è§’è‰²ï¼ˆé»˜è®¤è§’è‰²æ— æ³•åˆ é™¤ï¼‰
**æ¥å£åœ°å€ï¼š** /api/roles/{role_id}
**è¯·æ±‚æ–¹å¼ï¼š** DELETE

## 2. é¦–é¡µæ•°æ®çœ‹æ¿

### 2.1 è·å–æ•°æ®çœ‹æ¿æ¦‚è§ˆ

**æ¥å£åç§°ï¼š** è·å–é¦–é¡µæ•°æ®çœ‹æ¿
**åŠŸèƒ½æè¿°ï¼š** è·å–é¦–é¡µå±•ç¤ºçš„å„é¡¹ç»Ÿè®¡æ•°æ®å’Œå®æ—¶ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/dashboard/overview
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### åŠŸèƒ½è¯´æ˜
è¿”å›é¦–é¡µæ•°æ®çœ‹æ¿æ‰€éœ€çš„å„é¡¹ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›¸æœºåœ¨çº¿çŠ¶æ€ã€å‘Šè­¦ç»Ÿè®¡ã€åˆ†ç±»æ’åç­‰æ•°æ®ã€‚

```mermaid
sequenceDiagram
    participant Client
    participant API
    participant Database
    participant DeviceService
    Client->>API: è¯·æ±‚çœ‹æ¿æ•°æ®
    API->>Database: æŸ¥è¯¢ç»Ÿè®¡æ•°æ®
    API->>DeviceService: è·å–è®¾å¤‡çŠ¶æ€
    DeviceService-->>API: è¿”å›è®¾å¤‡ä¿¡æ¯
    Database-->>API: è¿”å›ç»Ÿè®¡ç»“æœ
    API-->>Client: è¿”å›çœ‹æ¿æ•°æ®
```

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "camera_stats": {
      "total_cameras": 30,
      "online_cameras": 28,
      "offline_cameras": 2,
      "online_rate": 0.933
    },
    "alarm_stats": {
      "week_total": 85,
      "today_total": 12,
      "unprocessed": 5,
      "processed": 7
    },
    "alarm_ranking": [
      {
        "type": "å¼‚å¸¸è¡Œä¸º",
        "count": 35,
        "percentage": 0.412
      },
      {
        "type": "è½¦è¾†è¿è§„",
        "count": 28,
        "percentage": 0.329
      },
      {
        "type": "äººå‘˜é—¯å…¥",
        "count": 22,
        "percentage": 0.259
      }
    ],
    "latest_alarms": [
      {
        "id": 101,
        "time": "2024-01-20 15:45:30",
        "type": "å¼‚å¸¸è¡Œä¸º",
        "location": "å‰é—¨",
        "image": "/uploads/alarms/20240120_1545_101.jpg",
        "device_name": "å‰é—¨æ‘„åƒå¤´"
      }
    ]
  },
  "message": "è·å–æ•°æ®çœ‹æ¿æˆåŠŸ",
  "success": true
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| error | int | æ˜¯ | é”™è¯¯ç  | 0 |
| body | object | æ˜¯ | å“åº”æ•°æ® | |
| body.camera_stats | object | æ˜¯ | ç›¸æœºç»Ÿè®¡ä¿¡æ¯ | |
| body.camera_stats.total_cameras | int | æ˜¯ | ç›¸æœºæ€»æ•° | 30 |
| body.camera_stats.online_cameras | int | æ˜¯ | åœ¨çº¿ç›¸æœºæ•° | 28 |
| body.camera_stats.offline_cameras | int | æ˜¯ | ç¦»çº¿ç›¸æœºæ•° | 2 |
| body.camera_stats.online_rate | float | æ˜¯ | åœ¨çº¿ç‡ | 0.933 |
| body.alarm_stats | object | æ˜¯ | å‘Šè­¦ç»Ÿè®¡ä¿¡æ¯ | |
| body.alarm_stats.week_total | int | æ˜¯ | ä¸€å‘¨å‘Šè­¦æ€»æ•° | 85 |
| body.alarm_stats.today_total | int | æ˜¯ | ä»Šæ—¥å‘Šè­¦æ€»æ•° | 12 |
| body.alarm_stats.unprocessed | int | æ˜¯ | æœªå¤„ç†å‘Šè­¦æ•° | 5 |
| body.alarm_stats.processed | int | æ˜¯ | å·²å¤„ç†å‘Šè­¦æ•° | 7 |
| body.alarm_ranking | array | æ˜¯ | å‘Šè­¦åˆ†ç±»æ’å | |
| body.latest_alarms | array | æ˜¯ | æœ€æ–°å‘Šè­¦æˆªå›¾ | |
| message | string | æ˜¯ | å“åº”æ¶ˆæ¯ | è·å–æ•°æ®çœ‹æ¿æˆåŠŸ |
| success | bool | æ˜¯ | æ˜¯å¦æˆåŠŸ | true |

### 2.2 è·å–CADå›¾å±‚ä¿¡æ¯

**æ¥å£åç§°ï¼š** è·å–CADå›¾å±‚é…ç½®
**åŠŸèƒ½æè¿°ï¼š** è·å–çš®å¸¦ä¸šåŠ¡åœºæ™¯çš„CADå›¾å±‚ä¿¡æ¯å’Œæ‘„åƒå¤´ç‚¹ä½
**æ¥å£åœ°å€ï¼š** /api/dashboard/cad-map
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "map_config": {
      "background_image": "/uploads/maps/belt_layout.png",
      "width": 1920,
      "height": 1080
    },
    "camera_points": [
      {
        "device_id": 1,
        "device_name": "çš®å¸¦å¤´éƒ¨æ‘„åƒå¤´",
        "x": 150,
        "y": 200,
        "status": "åœ¨çº¿",
        "stream_url": "rtmp://192.168.1.101:1935/live/stream1"
      },
      {
        "device_id": 2,
        "device_name": "çš®å¸¦å°¾éƒ¨æ‘„åƒå¤´",
        "x": 800,
        "y": 200,
        "status": "åœ¨çº¿",
        "stream_url": "rtmp://192.168.1.102:1935/live/stream2"
      }
    ]
  },
  "message": "è·å–CADå›¾å±‚ä¿¡æ¯æˆåŠŸ",
  "success": true
}
```

### 2.3 è·å–æ‘„åƒå¤´å®æ—¶ç”»é¢

**æ¥å£åç§°ï¼š** è·å–æŒ‡å®šæ‘„åƒå¤´å®æ—¶ç”»é¢
**åŠŸèƒ½æè¿°ï¼š** ç‚¹å‡»CADå›¾ä¸Šçš„æ‘„åƒå¤´å›¾æ ‡ï¼Œå¼¹å‡ºè¯¥æ‘„åƒå¤´çš„å®æ—¶ç”»é¢
**æ¥å£åœ°å€ï¼š** /api/dashboard/camera-live/{device_id}
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "device_id": 1,
    "device_name": "çš®å¸¦å¤´éƒ¨æ‘„åƒå¤´",
    "stream_url": "rtmp://192.168.1.101:1935/live/stream1",
    "backup_url": "rtsp://192.168.1.101:554/stream",
    "status": "åœ¨çº¿",
    "resolution": "1920x1080",
    "fps": 25
  },
  "message": "è·å–æ‘„åƒå¤´å®æ—¶ç”»é¢æˆåŠŸ",
  "success": true
}
```

## 3. è®¾å¤‡ç®¡ç†

### 3.1 è·å–è®¾å¤‡åˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–è®¾å¤‡åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** åˆ†é¡µè·å–ç³»ç»Ÿè®¾å¤‡åˆ—è¡¨ï¼Œæ”¯æŒå¤šæ¡ä»¶ç­›é€‰
**æ¥å£åœ°å€ï¼š** /api/devices
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰ | 10 |
| device_name | string | å¦ | è®¾å¤‡åç§°æœç´¢ | æ‘„åƒå¤´01 |
| device_sn | string | å¦ | è®¾å¤‡ç¼–å·æœç´¢ | SN123456 |
| device_type | string | å¦ | è®¾å¤‡ç±»å‹ç­›é€‰ | IPCæ‘„åƒæœº |
| status | string | å¦ | è®¾å¤‡çŠ¶æ€ç­›é€‰ | åœ¨çº¿ |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "devices": [
      {
        "id": 1,
        "device_name": "å‰é—¨æ‘„åƒå¤´",
        "device_sn": "SN202401001",
        "device_type": "IPCæ‘„åƒæœº",
        "manufacturer": "æµ·åº·å¨è§†",
        "ip_address": "192.168.1.101",
        "status": "åœ¨çº¿",
        "area": "åŒºåŸŸ1",
        "internal_code": "CODE-1001",
        "install_location": "æ¥¼å®‡1å±‚1å·æˆ¿é—´",
        "install_time": "2024-01-01",
        "line_info": "ç½‘çº¿1å·",
        "direction": "æœå‘ä¸œ",
        "related_camera_sn": "CAM-1001",
        "related_camera_name": "æ‘„åƒå¤´-1",
        "algorithm_model": "äººè„¸è¯†åˆ«",
        "model_version": "V1.2",
        "create_time": "2024-01-01 10:00:00",
        "update_time": "2024-01-20 15:30:00"
      }
    ],
    "total": 30,
    "page": 1,
    "page_size": 10
  },
  "message": "è·å–è®¾å¤‡åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 3.2 æ·»åŠ è®¾å¤‡

**æ¥å£åç§°ï¼š** æ·»åŠ æ–°è®¾å¤‡
**åŠŸèƒ½æè¿°ï¼š** å‘ç³»ç»Ÿä¸­æ·»åŠ æ–°çš„ç›‘æ§è®¾å¤‡
**æ¥å£åœ°å€ï¼š** /api/devices
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "device_name": "åé—¨æ‘„åƒå¤´",
  "device_sn": "SN202401002",
  "model": "å‹å·-X200",
  "manufacturer": "å¤§å",
  "device_type": "IPCæ‘„åƒæœº",
  "ip_address": "192.168.1.102",
  "area": "åŒºåŸŸ2",
  "internal_code": "CODE-1002",
  "install_location": "æ¥¼å®‡1å±‚2å·æˆ¿é—´",
  "install_time": "2024-01-20",
  "line_info": "ç½‘çº¿2å·",
  "direction": "æœå‘å—",
  "related_camera_sn": "CAM-1002",
  "related_camera_name": "æ‘„åƒå¤´-2",
  "algorithm_model": "è½¦è¾†è¯†åˆ«",
  "model_version": "V2.1"
}
```

### 3.3 æ‰¹é‡æ·»åŠ è®¾å¤‡

**æ¥å£åç§°ï¼š** æ‰¹é‡æ·»åŠ è®¾å¤‡
**åŠŸèƒ½æè¿°ï¼š** é€šè¿‡Excelæ–‡ä»¶æ‰¹é‡æ·»åŠ ç›‘æ§è®¾å¤‡
**æ¥å£åœ°å€ï¼š** /api/devices/batch
**è¯·æ±‚æ–¹å¼ï¼š** POST
**Content-Typeï¼š** multipart/form-data

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| file | file | æ˜¯ | Excelè®¾å¤‡åˆ—è¡¨æ–‡ä»¶ | devices.xlsx |

### 3.4 å¹³å°è®¾å¤‡åŒæ­¥

**æ¥å£åç§°ï¼š** å¹³å°è®¾å¤‡è‡ªåŠ¨åŒæ­¥
**åŠŸèƒ½æè¿°ï¼š** ä»ç½‘ç»œä¸­è‡ªåŠ¨å‘ç°å¹¶åŒæ­¥ç¬¦åˆåè®®çš„è®¾å¤‡
**æ¥å£åœ°å€ï¼š** /api/devices/sync
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "network_range": "192.168.1.0/24",
  "protocol": "GB28181",
  "timeout": 30
}
```

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "discovered_devices": [
      {
        "ip_address": "192.168.1.105",
        "device_id": "34020000001320000001",
        "device_name": "IPC-001",
        "manufacturer": "æµ·åº·å¨è§†",
        "model": "DS-2CD2025-I"
      }
    ],
    "sync_count": 3
  },
  "message": "è®¾å¤‡åŒæ­¥å®Œæˆ",
  "success": true
}
```

### 3.5 è®¾å¤‡æ¥å…¥åè®®é…ç½®

**æ¥å£åç§°ï¼š** é…ç½®è®¾å¤‡æ¥å…¥åè®®
**åŠŸèƒ½æè¿°ï¼š** é…ç½®è®¾å¤‡çš„GB28181ã€RTSPã€ONVIFç­‰æ¥å…¥åè®®å‚æ•°
**æ¥å£åœ°å€ï¼š** /api/devices/{device_id}/protocol
**è¯·æ±‚æ–¹å¼ï¼š** PUT

#### è¯·æ±‚å‚æ•°
```json
{
  "protocol_type": "GB28181",
  "config": {
    "sip_server_id": "34020000002000000001",
    "sip_server_domain": "3402000000",
    "sip_server_ip": "192.168.1.100",
    "sip_server_port": 5060,
    "device_id": "34020000001320000001",
    "device_password": "12345678",
    "heartbeat_interval": 60,
    "max_heartbeat_timeout": 300
  }
}
```

### 3.6 æ™ºèƒ½åˆ†ææ¿å¡ç»‘å®š

**æ¥å£åç§°ï¼š** ç»‘å®šæ™ºèƒ½åˆ†ææ¿å¡ä¸æ‘„åƒæœº
**åŠŸèƒ½æè¿°ï¼š** å°†æ™ºèƒ½åˆ†ææ¿å¡èŠ‚ç‚¹ä¸æ‘„åƒæœºå»ºç«‹ç»‘å®šå…³ç³»
**æ¥å£åœ°å€ï¼š** /api/devices/bind-analysis-card
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "camera_id": 1,
  "analysis_card_id": 101,
  "channel": 1,
  "algorithm_config": {
    "algorithm_type": "äººè„¸è¯†åˆ«",
    "detection_area": {
      "x": 0,
      "y": 0,
      "width": 1920,
      "height": 1080
    },
    "sensitivity": 0.8
  }
}
```

### 3.7 æ›´æ–°è®¾å¤‡ä¿¡æ¯

**æ¥å£åç§°ï¼š** æ›´æ–°è®¾å¤‡ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** æ›´æ–°æŒ‡å®šè®¾å¤‡çš„é…ç½®ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/devices/{device_id}
**è¯·æ±‚æ–¹å¼ï¼š** PUT

### 3.8 åˆ é™¤è®¾å¤‡

**æ¥å£åç§°ï¼š** åˆ é™¤è®¾å¤‡
**åŠŸèƒ½æè¿°ï¼š** ä»ç³»ç»Ÿä¸­åˆ é™¤æŒ‡å®šè®¾å¤‡
**æ¥å£åœ°å€ï¼š** /api/devices/{device_id}
**è¯·æ±‚æ–¹å¼ï¼š** DELETE

### 3.9 åˆ‡æ¢è®¾å¤‡çŠ¶æ€

**æ¥å£åç§°ï¼š** åˆ‡æ¢è®¾å¤‡åœ¨çº¿çŠ¶æ€
**åŠŸèƒ½æè¿°ï¼š** æ‰‹åŠ¨åˆ‡æ¢è®¾å¤‡çš„åœ¨çº¿/ç¦»çº¿çŠ¶æ€
**æ¥å£åœ°å€ï¼š** /api/devices/{device_id}/toggle-status
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "status": "ç¦»çº¿"
}
```

### 3.10 å¯¼å‡ºè®¾å¤‡åˆ—è¡¨

**æ¥å£åç§°ï¼š** å¯¼å‡ºè®¾å¤‡åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** å¯¼å‡ºè®¾å¤‡åˆ—è¡¨ä¸ºExcelæ–‡ä»¶
**æ¥å£åœ°å€ï¼š** /api/devices/export
**è¯·æ±‚æ–¹å¼ï¼š** GET

## 4. ç®—æ³•ç®¡ç†

### 4.1 è·å–ç®—æ³•åˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–ç®—æ³•ç‰ˆæœ¬åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** è·å–å·²ä¸Šä¼ çš„ç®—æ³•ç‰ˆæœ¬åˆ—è¡¨
**æ¥å£åœ°å€ï¼š** /api/algorithms
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "algorithms": [
      {
        "id": 1,
        "name": "CoreAlgo_01",
        "version": "V1.2.5",
        "type": ".zip",
        "size": "25.8 MB",
        "upload_time": "2024-01-15 14:30:00",
        "status": "å·²å‘å¸ƒ",
        "description": "è¿™æ˜¯æ ¸å¿ƒç®—æ³• 1ã€‚"
      }
    ],
    "total": 15
  },
  "message": "è·å–ç®—æ³•åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 4.2 ä¸Šä¼ ç®—æ³•

**æ¥å£åç§°ï¼š** ä¸Šä¼ ç®—æ³•æ–‡ä»¶
**åŠŸèƒ½æè¿°ï¼š** ä¸Šä¼ æ–°çš„ç®—æ³•åŒ…æ–‡ä»¶
**æ¥å£åœ°å€ï¼š** /api/algorithms/upload
**è¯·æ±‚æ–¹å¼ï¼š** POST
**Content-Typeï¼š** multipart/form-data

### 4.3 ç®—æ³•ä¸‹å‘

**æ¥å£åç§°ï¼š** æ‰§è¡Œç®—æ³•ä¸‹å‘
**åŠŸèƒ½æè¿°ï¼š** å°†ç®—æ³•åŒ…ä¸‹å‘åˆ°æ™ºèƒ½åˆ†æå¡
**æ¥å£åœ°å€ï¼š** /api/algorithms/dispatch
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "algorithm_version_id": 1,
  "target_card": "card001",
  "sync_rules": true
}
```

### 4.4 æ‰¹é‡ç®—æ³•ä¸‹å‘

**æ¥å£åç§°ï¼š** æ‰¹é‡ä¸‹å‘ç®—æ³•æ¨¡å‹
**åŠŸèƒ½æè¿°ï¼š** å°†ç®—æ³•æ¨¡å‹æ‰¹é‡ä¸‹å‘è‡³å¤šä¸ªæ™ºèƒ½åˆ†ææ¿å¡èŠ‚ç‚¹
**æ¥å£åœ°å€ï¼š** /api/algorithms/batch-dispatch
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "algorithm_version_id": 1,
  "target_cards": ["card001", "card002", "card003"],
  "sync_rules": true,
  "auto_restart": false
}
```

### 4.5 è§„åˆ™åŒæ­¥

**æ¥å£åç§°ï¼š** åŒæ­¥è§„åˆ™åˆ°åˆ†ææ¿
**åŠŸèƒ½æè¿°ï¼š** å•ç‹¬åŒæ­¥é…ç½®è§„åˆ™åˆ°æ™ºèƒ½åˆ†ææ¿
**æ¥å£åœ°å€ï¼š** /api/algorithms/sync-rules
**è¯·æ±‚æ–¹å¼ï¼š** POST

### 4.6 ç®—æ³•é…ç½®

**æ¥å£åç§°ï¼š** é…ç½®æ™ºèƒ½åˆ†æè§„åˆ™
**åŠŸèƒ½æè¿°ï¼š** ä¸ºæ™ºèƒ½åˆ†ææ¿å¡çš„æ¯ä¸€è·¯è§†é¢‘è®¾ç½®æ£€æµ‹è§„åˆ™
**æ¥å£åœ°å€ï¼š** /api/algorithms/config
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "analysis_card_id": 101,
  "channel": 1,
  "rules": [
    {
      "rule_type": "åŒºåŸŸå…¥ä¾µ",
      "detection_area": [
        {"x": 100, "y": 100},
        {"x": 500, "y": 100},
        {"x": 500, "y": 400},
        {"x": 100, "y": 400}
      ],
      "sensitivity": 0.8,
      "min_target_size": 50,
      "alarm_interval": 10
    }
  ]
}
```

### 4.7 åˆ é™¤ç®—æ³•æ¨¡å‹

**æ¥å£åç§°ï¼š** åˆ é™¤ç®—æ³•æ¨¡å‹
**åŠŸèƒ½æè¿°ï¼š** åˆ é™¤æŒ‡å®šçš„ç®—æ³•æ¨¡å‹ï¼ˆéœ€è¦ç¡®è®¤æ“ä½œï¼‰
**æ¥å£åœ°å€ï¼š** /api/algorithms/{algorithm_id}
**è¯·æ±‚æ–¹å¼ï¼š** DELETE

#### è¯·æ±‚å‚æ•°
```json
{
  "confirm": true,
  "reason": "ç®—æ³•ç‰ˆæœ¬è¿‡æ—§ï¼Œä¸å†ä½¿ç”¨"
}
```

### 4.8 è·å–ä¸‹å‘æ—¥å¿—

**æ¥å£åç§°ï¼š** è·å–ç®—æ³•ä¸‹å‘æ—¥å¿—
**åŠŸèƒ½æè¿°ï¼š** è·å–ç®—æ³•ä¸‹å‘çš„å†å²è®°å½•
**æ¥å£åœ°å€ï¼š** /api/algorithms/dispatch-logs
**è¯·æ±‚æ–¹å¼ï¼š** GET

## 5. å®æ—¶æ£€æµ‹

### 5.1 è·å–è§†é¢‘æµ

**æ¥å£åç§°ï¼š** è·å–å®æ—¶è§†é¢‘æµ
**åŠŸèƒ½æè¿°ï¼š** è·å–æŒ‡å®šæ‘„åƒå¤´çš„å®æ—¶è§†é¢‘æµåœ°å€
**æ¥å£åœ°å€ï¼š** /api/detection/video-stream/{device_id}
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "stream_url": "rtmp://192.168.1.101:1935/live/stream1",
    "backup_url": "rtsp://192.168.1.101:554/stream",
    "device_status": "åœ¨çº¿"
  },
  "message": "è·å–è§†é¢‘æµæˆåŠŸ",
  "success": true
}
```

### 5.2 è·å–å¤šè·¯è§†é¢‘æµ

**æ¥å£åç§°ï¼š** è·å–å¤šè·¯è§†é¢‘æµ
**åŠŸèƒ½æè¿°ï¼š** è·å–å¤šä¸ªæ‘„åƒå¤´çš„è§†é¢‘æµä¿¡æ¯ï¼Œç”¨äºå¤šåˆ†å±æ˜¾ç¤º
**æ¥å£åœ°å€ï¼š** /api/detection/multi-streams
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| device_ids | string | æ˜¯ | è®¾å¤‡IDåˆ—è¡¨(é€—å·åˆ†éš”) | 1,2,3,4 |
| layout | int | å¦ | å¸ƒå±€æ¨¡å¼ | 4 |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "layout": 4,
    "streams": [
      {
        "device_id": 1,
        "device_name": "å‰é—¨æ‘„åƒå¤´",
        "stream_url": "rtmp://192.168.1.101:1935/live/stream1",
        "status": "åœ¨çº¿",
        "position": 1
      },
      {
        "device_id": 2,
        "device_name": "åé—¨æ‘„åƒå¤´",
        "stream_url": "rtmp://192.168.1.102:1935/live/stream2",
        "status": "åœ¨çº¿",
        "position": 2
      }
    ]
  },
  "message": "è·å–å¤šè·¯è§†é¢‘æµæˆåŠŸ",
  "success": true
}
```

### 5.3 æ£€æµ‹é¢„è­¦ä¿¡æ¯

**æ¥å£åç§°ï¼š** è·å–å®æ—¶é¢„è­¦ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** è·å–å½“å‰å®æ—¶æ£€æµ‹åˆ°çš„é¢„è­¦ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/detection/warnings
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "warnings": [
      {
        "device_id": 2,
        "device_name": "å‰é—¨æ‘„åƒå¤´",
        "warning_type": "å¼‚å¸¸è¡Œä¸º",
        "description": "æ£€æµ‹åˆ°å¯ç–‘äººå‘˜é€—ç•™",
        "confidence": 0.85,
        "timestamp": "2024-01-20 15:45:30"
      }
    ]
  },
  "message": "è·å–é¢„è­¦ä¿¡æ¯æˆåŠŸ",
  "success": true
}
```

### 5.4 äº‘é•œæ§åˆ¶

**æ¥å£åç§°ï¼š** æ‘„åƒå¤´äº‘é•œæ§åˆ¶
**åŠŸèƒ½æè¿°ï¼š** æ§åˆ¶æ”¯æŒPTZåŠŸèƒ½çš„æ‘„åƒå¤´è¿›è¡Œè½¬åŠ¨ã€ç¼©æ”¾ç­‰æ“ä½œ
**æ¥å£åœ°å€ï¼š** /api/detection/ptz-control/{device_id}
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "command": "move",
  "direction": "up",
  "speed": 5,
  "duration": 3
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| command | string | æ˜¯ | æ§åˆ¶å‘½ä»¤ | move/zoom/focus/preset |
| direction | string | å¦ | ç§»åŠ¨æ–¹å‘ | up/down/left/right |
| speed | int | å¦ | ç§»åŠ¨é€Ÿåº¦(1-10) | 5 |
| duration | int | å¦ | æŒç»­æ—¶é—´(ç§’) | 3 |
| zoom_factor | float | å¦ | ç¼©æ”¾å€æ•° | 2.0 |
| preset_id | int | å¦ | é¢„ç½®ä½ID | 1 |

## 6. å½•åƒç®¡ç†

### 6.1 è·å–å½•åƒåˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–å½•åƒæ–‡ä»¶åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** è·å–ç³»ç»Ÿå­˜å‚¨çš„å½•åƒæ–‡ä»¶åˆ—è¡¨ï¼Œæ”¯æŒæ—¶é—´å’Œè®¾å¤‡ç­›é€‰
**æ¥å£åœ°å€ï¼š** /api/recordings
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### åŠŸèƒ½è¯´æ˜
ç³»ç»Ÿå­˜å‚¨è§¦å‘é¢„è­¦å‰å10ç§’çš„å½•åƒï¼Œå½•åƒç”»é¢åŒ…å«è·Ÿè¸ªæ¡†ä¿¡æ¯ã€‚

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰ | 10 |
| device_id | int | å¦ | è®¾å¤‡IDç­›é€‰ | 1 |
| start_time | string | å¦ | å¼€å§‹æ—¶é—´ | 2024-01-20 00:00:00 |
| end_time | string | å¦ | ç»“æŸæ—¶é—´ | 2024-01-20 23:59:59 |
| alarm_type | string | å¦ | è§¦å‘å‘Šè­¦ç±»å‹ | å¼‚å¸¸è¡Œä¸º |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "recordings": [
      {
        "id": 1,
        "device_id": 1,
        "device_name": "å‰é—¨æ‘„åƒå¤´",
        "alarm_id": 101,
        "alarm_type": "å¼‚å¸¸è¡Œä¸º",
        "start_time": "2024-01-20 10:29:50",
        "end_time": "2024-01-20 10:30:10",
        "duration": 20,
        "file_path": "/recordings/20240120/1029_50_alarm_101.mp4",
        "file_size": "15.2 MB",
        "has_tracking_box": true,
        "create_time": "2024-01-20 10:30:00"
      }
    ],
    "total": 50,
    "page": 1,
    "page_size": 10
  },
  "message": "è·å–å½•åƒåˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 6.2 æ’­æ”¾å½•åƒ

**æ¥å£åç§°ï¼š** è·å–å½•åƒæ’­æ”¾åœ°å€
**åŠŸèƒ½æè¿°ï¼š** è·å–æŒ‡å®šå½•åƒæ–‡ä»¶çš„æ’­æ”¾åœ°å€
**æ¥å£åœ°å€ï¼š** /api/recordings/{recording_id}/play
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "recording_id": 1,
    "play_url": "http://192.168.1.100:8080/recordings/20240120/1029_50_alarm_101.mp4",
    "duration": 20,
    "resolution": "1920x1080",
    "fps": 25,
    "has_tracking_box": true
  },
  "message": "è·å–å½•åƒæ’­æ”¾åœ°å€æˆåŠŸ",
  "success": true
}
```

### 6.3 ä¸‹è½½å½•åƒ

**æ¥å£åç§°ï¼š** ä¸‹è½½å½•åƒæ–‡ä»¶
**åŠŸèƒ½æè¿°ï¼š** ä¸‹è½½æŒ‡å®šçš„å½•åƒæ–‡ä»¶åˆ°æœ¬åœ°
**æ¥å£åœ°å€ï¼š** /api/recordings/{recording_id}/download
**è¯·æ±‚æ–¹å¼ï¼š** GET

### 6.4 åˆ é™¤å½•åƒ

**æ¥å£åç§°ï¼š** åˆ é™¤å½•åƒæ–‡ä»¶
**åŠŸèƒ½æè¿°ï¼š** åˆ é™¤æŒ‡å®šçš„å½•åƒæ–‡ä»¶ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†6ä¸ªæœˆå‰çš„å½•åƒï¼‰
**æ¥å£åœ°å€ï¼š** /api/recordings/{recording_id}
**è¯·æ±‚æ–¹å¼ï¼š** DELETE

### 6.5 å½•åƒç»Ÿè®¡

**æ¥å£åç§°ï¼š** è·å–å½•åƒå­˜å‚¨ç»Ÿè®¡
**åŠŸèƒ½æè¿°ï¼š** è·å–å½•åƒå­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µå’Œç»Ÿè®¡ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/recordings/statistics
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "total_recordings": 1250,
    "total_size": "25.6 GB",
    "available_space": "150.2 GB",
    "retention_days": 180,
    "auto_cleanup": true,
    "daily_average": "142.3 MB"
  },
  "message": "è·å–å½•åƒç»Ÿè®¡æˆåŠŸ",
  "success": true
}
```

## 7. äº‹ä»¶ä¸­å¿ƒä¸æŠ¥è­¦

### 7.1 è·å–æŠ¥è­¦åˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–æŠ¥è­¦äº‹ä»¶åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** åˆ†é¡µè·å–ç³»ç»ŸæŠ¥è­¦äº‹ä»¶ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´å’Œç±»å‹ç­›é€‰
**æ¥å£åœ°å€ï¼š** /api/events/alarms
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰ | 10 |
| start_time | string | å¦ | å¼€å§‹æ—¶é—´ | 2024-01-20 00:00:00 |
| end_time | string | å¦ | ç»“æŸæ—¶é—´ | 2024-01-20 23:59:59 |
| alarm_type | string | å¦ | æŠ¥è­¦ç±»å‹ | behavior |
| location_id | int | å¦ | ç‚¹ä½ID | 1 |
| status | string | å¦ | å¤„ç†çŠ¶æ€ | æœªå¤„ç† |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "alarms": [
      {
        "id": 1,
        "time": "2024-01-20 10:30:00",
        "type": "å¼‚å¸¸è¡Œä¸º",
        "location": "å‰é—¨",
        "location_id": 1,
        "device_id": 1,
        "device_name": "å‰é—¨æ‘„åƒå¤´",
        "description": "æ£€æµ‹åˆ°å¯ç–‘äººå‘˜é€—ç•™",
        "confidence": 0.85,
        "status": "æœªå¤„ç†",
        "images": [
          "/uploads/alarms/20240120_1030_001.jpg",
          "/uploads/alarms/20240120_1030_002.jpg"
        ],
        "create_time": "2024-01-20 10:30:00",
        "process_time": null,
        "process_user": null
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 10
  },
  "message": "è·å–æŠ¥è­¦åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 7.2 è·å–æŠ¥è­¦è¯¦æƒ…

**æ¥å£åç§°ï¼š** è·å–æŠ¥è­¦äº‹ä»¶è¯¦æƒ…
**åŠŸèƒ½æè¿°ï¼š** è·å–æŒ‡å®šæŠ¥è­¦äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/events/alarms/{alarm_id}
**è¯·æ±‚æ–¹å¼ï¼š** GET

### 7.3 å¤„ç†æŠ¥è­¦äº‹ä»¶

**æ¥å£åç§°ï¼š** å¤„ç†æŠ¥è­¦äº‹ä»¶
**åŠŸèƒ½æè¿°ï¼š** æ ‡è®°æŠ¥è­¦äº‹ä»¶ä¸ºå·²å¤„ç†çŠ¶æ€
**æ¥å£åœ°å€ï¼š** /api/events/alarms/{alarm_id}/process
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "process_note": "å·²ç¡®è®¤ä¸ºè¯¯æŠ¥ï¼Œç°åœºæ— å¼‚å¸¸æƒ…å†µ"
}
```

### 7.4 è´Ÿæ ·æœ¬æ ‡è®°

**æ¥å£åç§°ï¼š** æ ‡è®°æŠ¥è­¦ä¸ºè´Ÿæ ·æœ¬
**åŠŸèƒ½æè¿°ï¼š** å°†è¯¯æŠ¥çš„æŠ¥è­¦äº‹ä»¶æ ‡è®°ä¸ºè´Ÿæ ·æœ¬ï¼Œç”¨äºç®—æ³•è®­ç»ƒä¼˜åŒ–
**æ¥å£åœ°å€ï¼š** /api/events/alarms/{alarm_id}/mark-negative
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "reason": "è¯¯æŠ¥-ç¯å¢ƒå¹²æ‰°",
  "upload_to_training": true
}
```

### 7.5 å¯¼å‡ºæ ·æœ¬æ•°æ®

**æ¥å£åç§°ï¼š** å¯¼å‡ºäººå·¥å®¡æ ¸æ ·æœ¬
**åŠŸèƒ½æè¿°ï¼š** æ‰‹åŠ¨å¯¼å‡ºäººå·¥å®¡æ ¸çš„è¯¯æŠ¥æ ·æœ¬æ•°æ®
**æ¥å£åœ°å€ï¼š** /api/events/alarms/export-samples
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "start_time": "2024-01-01 00:00:00",
  "end_time": "2024-01-20 23:59:59",
  "sample_type": "negative",
  "export_format": "zip"
}
```

### 7.6 è·å–ç‚¹ä½åˆ—è¡¨

**æ¥å£åç§°ï¼š** è·å–ç›‘æ§ç‚¹ä½åˆ—è¡¨
**åŠŸèƒ½æè¿°ï¼š** è·å–ç³»ç»Ÿä¸­é…ç½®çš„ç›‘æ§ç‚¹ä½ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/events/locations
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "locations": [
      {
        "id": 1,
        "name": "å‰é—¨",
        "description": "ä¸»å…¥å£ç›‘æ§ç‚¹",
        "device_count": 2
      },
      {
        "id": 2,
        "name": "åé—¨",
        "description": "åé—¨å‡ºå…¥å£",
        "device_count": 1
      }
    ]
  },
  "message": "è·å–ç‚¹ä½åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 7.7 å³æ—¶å‘Šè­¦é…ç½®

**æ¥å£åç§°ï¼š** é…ç½®å³æ—¶å‘Šè­¦æ¥æ”¶
**åŠŸèƒ½æè¿°ï¼š** ç”¨æˆ·é…ç½®æ¥æ”¶ç‰¹å®šç±»å‹å‘Šè­¦çš„æ–¹å¼å’Œæ¡ä»¶
**æ¥å£åœ°å€ï¼š** /api/events/instant-alert-config
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "user_id": 1,
  "alert_types": ["å¼‚å¸¸è¡Œä¸º", "äººå‘˜é—¯å…¥"],
  "notification_methods": ["web_popup", "email", "bubble"],
  "location_filter": [1, 2],
  "time_filter": {
    "start_time": "08:00:00",
    "end_time": "18:00:00",
    "weekdays": [1, 2, 3, 4, 5]
  }
}
```

### 7.8 å³æ—¶å‘Šè­¦æ¨é€

**æ¥å£åç§°ï¼š** æ¨é€å³æ—¶å‘Šè­¦æ¶ˆæ¯
**åŠŸèƒ½æè¿°ï¼š** å®æ—¶æ¨é€å‘Šè­¦æ¶ˆæ¯åˆ°ç”¨æˆ·ç»ˆç«¯ï¼ˆWebSocketè¿æ¥ï¼‰
**æ¥å£åœ°å€ï¼š** WebSocket: /ws/instant-alerts/{user_id}
**è¯·æ±‚æ–¹å¼ï¼š** WebSocket

#### æ¨é€æ¶ˆæ¯æ ¼å¼
```json
{
  "type": "instant_alert",
  "data": {
    "alarm_id": 102,
    "alert_type": "å¼‚å¸¸è¡Œä¸º",
    "object_name": "å¯ç–‘äººå‘˜",
    "location": "å‰é—¨",
    "time": "2024-01-20 15:45:30",
    "description": "æ£€æµ‹åˆ°å¯ç–‘äººå‘˜é€—ç•™",
    "image": "/uploads/alarms/20240120_1545_102.jpg",
    "video_url": "/api/recordings/102/play"
  }
}
```

### 7.9 å‘Šè­¦è”åŠ¨è®¾ç½®

**æ¥å£åç§°ï¼š** é…ç½®å‘Šè­¦è”åŠ¨è§„åˆ™
**åŠŸèƒ½æè¿°ï¼š** è®¾ç½®å‘Šè­¦è§¦å‘æ—¶çš„è”åŠ¨åŠ¨ä½œå’Œä¸‰çº§é¢„è­¦æ¨¡å‹
**æ¥å£åœ°å€ï¼š** /api/events/linkage-settings
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "rule_name": "åŒºåŸŸ1å¼‚å¸¸è¡Œä¸ºè”åŠ¨",
  "trigger_conditions": {
    "alarm_types": ["å¼‚å¸¸è¡Œä¸º"],
    "locations": [1],
    "confidence_threshold": 0.8
  },
  "actions": [
    {
      "action_type": "å¹¿æ’­",
      "level": 1,
      "config": {
        "message": "æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼Œè¯·æ³¨æ„æŸ¥çœ‹",
        "duration": 10,
        "repeat": 3
      }
    },
    {
      "action_type": "å£°å…‰",
      "level": 2,
      "config": {
        "light_duration": 30,
        "sound_duration": 15,
        "sound_type": "è­¦æŠ¥"
      }
    },
    {
      "action_type": "æ§åˆ¶",
      "level": 3,
      "config": {
        "device_id": 201,
        "command": "close_valve",
        "delay": 5
      }
    }
  ]
}
```

### 7.10 è”åŠ¨é¢„æ¡ˆç®¡ç†

**æ¥å£åç§°ï¼š** ç®¡ç†è”åŠ¨é¢„æ¡ˆ
**åŠŸèƒ½æè¿°ï¼š** é¢„å…ˆè®¾å®šå„ç§åº”æ€¥æƒ…å†µçš„è”åŠ¨é¢„æ¡ˆ
**æ¥å£åœ°å€ï¼š** /api/events/emergency-plans
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "plan_name": "ç«ç¾åº”æ€¥é¢„æ¡ˆ",
  "description": "å‘ç”Ÿç«ç¾æ—¶çš„åº”æ€¥å¤„ç½®æµç¨‹",
  "trigger_conditions": {
    "alarm_types": ["ç«ç¾å‘Šè­¦", "çƒŸé›¾æ£€æµ‹"],
    "priority": "high"
  },
  "action_sequence": [
    {
      "step": 1,
      "action": "ç«‹å³åœæ­¢æ‰€æœ‰è®¾å¤‡è¿è¡Œ",
      "device_ids": [1, 2, 3],
      "command": "emergency_stop"
    },
    {
      "step": 2,
      "action": "å¯åŠ¨æ¶ˆé˜²ç³»ç»Ÿ",
      "device_ids": [301, 302],
      "command": "activate_fire_system"
    },
    {
      "step": 3,
      "action": "é€šçŸ¥ç›¸å…³äººå‘˜",
      "notification": {
        "methods": ["sms", "call", "email"],
        "recipients": ["119", "emergency_team"]
      }
    }
  ]
}
```

### 7.11 é¢„è­¦æ¨é€é…ç½®

**æ¥å£åç§°ï¼š** é…ç½®é¢„è­¦æ¨é€æ¸ é“
**åŠŸèƒ½æè¿°ï¼š** é…ç½®å°†é¢„è­¦æ•°æ®æ¨é€è‡³é‚®ä»¶ã€APPç­‰å¤–éƒ¨å¹³å°
**æ¥å£åœ°å€ï¼š** /api/events/push-config
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "push_channels": [
    {
      "channel_type": "email",
      "config": {
        "smtp_server": "smtp.company.com",
        "smtp_port": 587,
        "username": "alerts@company.com",
        "password": "password123",
        "recipients": ["manager@company.com", "security@company.com"]
      },
      "filter": {
        "alarm_types": ["ç«ç¾å‘Šè­¦", "å…¥ä¾µæ£€æµ‹"],
        "min_confidence": 0.9
      }
    },
    {
      "channel_type": "app_push",
      "config": {
        "app_key": "your_app_key",
        "app_secret": "your_app_secret",
        "push_url": "https://api.push.company.com/send"
      },
      "filter": {
        "alarm_types": ["*"],
        "locations": [1, 2, 3]
      }
    }
  ]
}
```

### 7.12 æ•°æ®é‡‡é›†

**æ¥å£åç§°ï¼š** è·å–æ•°æ®é‡‡é›†ç»Ÿè®¡
**åŠŸèƒ½æè¿°ï¼š** è·å–ç³»ç»Ÿæ•°æ®é‡‡é›†çš„ç»Ÿè®¡ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/events/data-collection
**è¯·æ±‚æ–¹å¼ï¼š** GET

### 7.13 å³æ—¶æŒ‡ä»¤

**æ¥å£åç§°ï¼š** å‘é€å³æ—¶æŒ‡ä»¤
**åŠŸèƒ½æè¿°ï¼š** å‘æŒ‡å®šè®¾å¤‡å‘é€æ§åˆ¶æŒ‡ä»¤
**æ¥å£åœ°å€ï¼š** /api/events/immediate-command
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "device_id": 1,
  "command_type": "PTZ",
  "parameters": {
    "direction": "up",
    "speed": 5
  }
}
```

## 8. ç³»ç»Ÿç®¡ç†

### 8.1 åŸºç¡€é…ç½®

**æ¥å£åç§°ï¼š** è·å–ç³»ç»ŸåŸºç¡€é…ç½®
**åŠŸèƒ½æè¿°ï¼š** è·å–ç³»ç»Ÿçš„åŸºç¡€é…ç½®ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/system/config/basic
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "system_name": "æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°",
    "platform_ip": "192.168.1.100",
    "platform_port": 8080,
    "time_sync_enabled": true,
    "ntp_server": "ntp.pool.org",
    "timezone": "Asia/Shanghai",
    "max_camera_count": 1000,
    "current_camera_count": 30
  },
  "message": "è·å–åŸºç¡€é…ç½®æˆåŠŸ",
  "success": true
}
```

### 8.2 æ›´æ–°åŸºç¡€é…ç½®

**æ¥å£åç§°ï¼š** æ›´æ–°ç³»ç»ŸåŸºç¡€é…ç½®
**åŠŸèƒ½æè¿°ï¼š** æ›´æ–°ç³»ç»Ÿçš„åŸºç¡€é…ç½®å‚æ•°
**æ¥å£åœ°å€ï¼š** /api/system/config/basic
**è¯·æ±‚æ–¹å¼ï¼š** PUT

#### è¯·æ±‚å‚æ•°
```json
{
  "system_name": "æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°V2",
  "platform_ip": "192.168.1.101",
  "platform_port": 8080,
  "time_sync_enabled": true,
  "ntp_server": "cn.pool.ntp.org",
  "timezone": "Asia/Shanghai"
}
```

### 8.3 ä¿®æ”¹å¹³å°IP

**æ¥å£åç§°ï¼š** ä¸€é”®ä¿®æ”¹å¹³å°IP
**åŠŸèƒ½æè¿°ï¼š** ä¿®æ”¹å¹³å°IPåœ°å€å¹¶è‡ªåŠ¨é‡å¯æœåŠ¡
**æ¥å£åœ°å€ï¼š** /api/system/config/change-ip
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### åŠŸèƒ½è¯´æ˜
ä¿®æ”¹å¹³å°IPåç³»ç»Ÿä¼šè‡ªåŠ¨é‡å¯ç›¸å…³æœåŠ¡ï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ–°åœ°å€è®¿é—®å¹³å°ã€‚

#### è¯·æ±‚å‚æ•°
```json
{
  "new_ip": "192.168.1.200",
  "confirm": true,
  "auto_restart": true
}
```

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "old_ip": "192.168.1.100",
    "new_ip": "192.168.1.200",
    "restart_required": true,
    "new_access_url": "http://192.168.1.200:8080"
  },
  "message": "IPä¿®æ”¹æˆåŠŸï¼Œç³»ç»Ÿå°†åœ¨30ç§’åé‡å¯",
  "success": true
}
```

### 8.4 æ—¶é—´åŒæ­¥

**æ¥å£åç§°ï¼š** æ‰§è¡Œæ—¶é—´åŒæ­¥
**åŠŸèƒ½æè¿°ï¼š** å‰ç«¯è®¾å¤‡å’Œå¹³å°æœåŠ¡å™¨è¿›è¡Œè‡ªåŠ¨æ—¶é—´åŒæ­¥
**æ¥å£åœ°å€ï¼š** /api/system/config/time-sync
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "sync_devices": true,
  "ntp_server": "cn.pool.ntp.org"
}
```

### 8.5 åœ°å›¾ç®¡ç†

**æ¥å£åç§°ï¼š** è·å–åœ°å›¾é…ç½®
**åŠŸèƒ½æè¿°ï¼š** è·å–ç›‘æ§åŒºåŸŸçš„åœ°å›¾é…ç½®ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/system/config/map
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "background_image": "/uploads/maps/layout.png",
    "width": 1920,
    "height": 1080,
    "camera_positions": [
      {
        "device_id": 1,
        "x": 150,
        "y": 200,
        "icon": "camera"
      }
    ]
  },
  "message": "è·å–åœ°å›¾é…ç½®æˆåŠŸ",
  "success": true
}
```

### 8.6 ä¸Šä¼ åœ°å›¾èƒŒæ™¯

**æ¥å£åç§°ï¼š** ä¸Šä¼ åœ°å›¾èƒŒæ™¯å›¾ç‰‡
**åŠŸèƒ½æè¿°ï¼š** ä¸Šä¼ æœ¬åœ°å›¾ç‰‡æ–‡ä»¶ä½œä¸ºåœ°å›¾èƒŒæ™¯
**æ¥å£åœ°å€ï¼š** /api/system/config/map/upload-background
**è¯·æ±‚æ–¹å¼ï¼š** POST
**Content-Typeï¼š** multipart/form-data

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| background_image | file | æ˜¯ | åœ°å›¾èƒŒæ™¯å›¾ç‰‡ | layout.png |

### 8.7 æ›´æ–°æ‘„åƒæœºç‚¹ä½

**æ¥å£åç§°ï¼š** æ›´æ–°æ‘„åƒæœºç‚¹ä½ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** è°ƒæ•´åœ°å›¾ä¸Šæ‘„åƒæœºçš„ç‚¹ä½ä½ç½®
**æ¥å£åœ°å€ï¼š** /api/system/config/map/update-positions
**è¯·æ±‚æ–¹å¼ï¼š** PUT

#### è¯·æ±‚å‚æ•°
```json
{
  "positions": [
    {
      "device_id": 1,
      "x": 200,
      "y": 250
    },
    {
      "device_id": 2,
      "x": 800,
      "y": 300
    }
  ]
}
```

### 8.8 å¯¼å‡ºç‚¹ä½é…ç½®

**æ¥å£åç§°ï¼š** å¯¼å‡ºç‚¹ä½é…ç½®ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** å¯¼å‡ºå½“å‰çš„æ‘„åƒæœºç‚¹ä½é…ç½®ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/system/config/map/export-positions
**è¯·æ±‚æ–¹å¼ï¼š** GET

### 8.9 å¯¼å…¥ç‚¹ä½é…ç½®

**æ¥å£åç§°ï¼š** å¯¼å…¥ç‚¹ä½é…ç½®ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** å¯¼å…¥ä¹‹å‰ä¿å­˜çš„ç‚¹ä½é…ç½®ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/system/config/map/import-positions
**è¯·æ±‚æ–¹å¼ï¼š** POST
**Content-Typeï¼š** multipart/form-data

### 8.10 ç‰ˆæœ¬ç®¡ç†

**æ¥å£åç§°ï¼š** è·å–ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯
**åŠŸèƒ½æè¿°ï¼š** è·å–å½“å‰ç³»ç»Ÿç‰ˆæœ¬å’Œæ›´æ–°ä¿¡æ¯
**æ¥å£åœ°å€ï¼š** /api/system/version
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "current_version": "V2.1.0",
    "build_time": "2024-01-15 10:30:00",
    "update_available": true,
    "latest_version": "V2.2.0",
    "update_notes": "ä¿®å¤è‹¥å¹²bugï¼Œä¼˜åŒ–ç®—æ³•æ€§èƒ½"
  },
  "message": "è·å–ç‰ˆæœ¬ä¿¡æ¯æˆåŠŸ",
  "success": true
}
```

### 8.11 å¤‡ä»½ç³»ç»Ÿç‰ˆæœ¬

**æ¥å£åç§°ï¼š** å¤‡ä»½å½“å‰ç³»ç»Ÿç‰ˆæœ¬
**åŠŸèƒ½æè¿°ï¼š** åˆ›å»ºå½“å‰ç³»ç»Ÿç‰ˆæœ¬çš„å¤‡ä»½
**æ¥å£åœ°å€ï¼š** /api/system/version/backup
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "backup_name": "ç‰ˆæœ¬å¤‡ä»½_2024_01_20",
  "include_data": true,
  "include_config": true
}
```

### 8.12 ç³»ç»Ÿå‡çº§

**æ¥å£åç§°ï¼š** ç³»ç»Ÿä¸€é”®å‡çº§
**åŠŸèƒ½æè¿°ï¼š** ä¸Šä¼ å‡çº§åŒ…è¿›è¡Œç³»ç»Ÿä¸€é”®å‡çº§
**æ¥å£åœ°å€ï¼š** /api/system/version/upgrade
**è¯·æ±‚æ–¹å¼ï¼š** POST
**Content-Typeï¼š** multipart/form-data

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| upgrade_package | file | æ˜¯ | å‡çº§åŒ…æ–‡ä»¶(.zip/.tar/.gz) | system_v2.2.0.zip |
| backup_before_upgrade | bool | å¦ | å‡çº§å‰æ˜¯å¦å¤‡ä»½ | true |

## 9. ç»Ÿè®¡åˆ†æ

### 9.1 è·å–ç»Ÿè®¡æ¦‚è§ˆ

**æ¥å£åç§°ï¼š** è·å–ç³»ç»Ÿç»Ÿè®¡æ¦‚è§ˆ
**åŠŸèƒ½æè¿°ï¼š** è·å–ç³»ç»Ÿè¿è¡Œçš„æ•´ä½“ç»Ÿè®¡æ•°æ®
**æ¥å£åœ°å€ï¼š** /api/statistics/overview
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "total_devices": 30,
    "online_devices": 28,
    "total_alarms_today": 15,
    "processed_alarms_today": 12,
    "detection_accuracy": 0.92,
    "system_uptime": "99.8%"
  },
  "message": "è·å–ç»Ÿè®¡æ¦‚è§ˆæˆåŠŸ",
  "success": true
}
```

### 9.2 è®¾å¤‡çŠ¶æ€ç»Ÿè®¡

**æ¥å£åç§°ï¼š** è·å–è®¾å¤‡çŠ¶æ€ç»Ÿè®¡
**åŠŸèƒ½æè¿°ï¼š** è·å–è®¾å¤‡åœ¨çº¿ç‡å’ŒçŠ¶æ€åˆ†å¸ƒç»Ÿè®¡
**æ¥å£åœ°å€ï¼š** /api/statistics/device-status
**è¯·æ±‚æ–¹å¼ï¼š** GET

### 9.3 æŠ¥è­¦è¶‹åŠ¿åˆ†æ

**æ¥å£åç§°ï¼š** è·å–æŠ¥è­¦è¶‹åŠ¿åˆ†æ
**åŠŸèƒ½æè¿°ï¼š** è·å–æŒ‡å®šæ—¶é—´æ®µçš„æŠ¥è­¦è¶‹åŠ¿æ•°æ®
**æ¥å£åœ°å€ï¼š** /api/statistics/alarm-trend
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| start_date | string | æ˜¯ | å¼€å§‹æ—¥æœŸ | 2024-01-01 |
| end_date | string | æ˜¯ | ç»“æŸæ—¥æœŸ | 2024-01-20 |
| granularity | string | å¦ | æ—¶é—´ç²’åº¦(day/hour) | day |

### 9.4 å¤šç»´åº¦é¢„è­¦ç»Ÿè®¡

**æ¥å£åç§°ï¼š** è·å–å¤šç»´åº¦é¢„è­¦ç»Ÿè®¡
**åŠŸèƒ½æè¿°ï¼š** é’ˆå¯¹ä¸åŒç»´åº¦çš„é¢„è­¦ä¿¡æ¯è¿›è¡Œåˆ†ç±»ç»Ÿè®¡
**æ¥å£åœ°å€ï¼š** /api/statistics/alarm-multi-dimension
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| dimensions | string | æ˜¯ | ç»Ÿè®¡ç»´åº¦ï¼ˆé€—å·åˆ†éš”ï¼‰ | type,location,time |
| start_date | string | æ˜¯ | å¼€å§‹æ—¥æœŸ | 2024-01-01 |
| end_date | string | æ˜¯ | ç»“æŸæ—¥æœŸ | 2024-01-20 |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "by_type": [
      {"type": "å¼‚å¸¸è¡Œä¸º", "count": 45, "percentage": 0.35},
      {"type": "è½¦è¾†è¿è§„", "count": 32, "percentage": 0.25},
      {"type": "äººå‘˜é—¯å…¥", "count": 28, "percentage": 0.22}
    ],
    "by_location": [
      {"location": "å‰é—¨", "count": 38, "percentage": 0.30},
      {"location": "åé—¨", "count": 25, "percentage": 0.20},
      {"location": "ä¾§é—¨", "count": 22, "percentage": 0.17}
    ],
    "by_time": [
      {"hour": "08:00-09:00", "count": 12},
      {"hour": "14:00-15:00", "count": 18},
      {"hour": "20:00-21:00", "count": 8}
    ]
  },
  "message": "è·å–å¤šç»´åº¦ç»Ÿè®¡æˆåŠŸ",
  "success": true
}
```

### 9.5 å¯¼å‡ºç»Ÿè®¡æŠ¥å‘Š

**æ¥å£åç§°ï¼š** å¯¼å‡ºç»Ÿè®¡åˆ†ææŠ¥å‘Š
**åŠŸèƒ½æè¿°ï¼š** å°†ç»Ÿè®¡åˆ†ææ•°æ®å¯¼å‡ºä¸ºExcelæˆ–PDFæŠ¥å‘Š
**æ¥å£åœ°å€ï¼š** /api/statistics/export-report
**è¯·æ±‚æ–¹å¼ï¼š** POST

#### è¯·æ±‚å‚æ•°
```json
{
  "report_type": "comprehensive",
  "start_date": "2024-01-01",
  "end_date": "2024-01-20",
  "export_format": "excel",
  "include_charts": true
}
```

## 10. æ—¥å¿—ç®¡ç†

### 10.1 è·å–ç³»ç»Ÿæ—¥å¿—

**æ¥å£åç§°ï¼š** è·å–ç³»ç»Ÿæ“ä½œæ—¥å¿—
**åŠŸèƒ½æè¿°ï¼š** åˆ†é¡µè·å–ç³»ç»Ÿæ“ä½œæ—¥å¿—è®°å½•
**æ¥å£åœ°å€ï¼š** /api/logs
**è¯·æ±‚æ–¹å¼ï¼š** GET

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| page | int | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | 1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰ | 10 |
| start_time | string | å¦ | å¼€å§‹æ—¶é—´ | 2024-01-20 00:00:00 |
| end_time | string | å¦ | ç»“æŸæ—¶é—´ | 2024-01-20 23:59:59 |
| log_level | string | å¦ | æ—¥å¿—çº§åˆ« | ERROR |
| module | string | å¦ | æ¨¡å—åç§° | UserManagement |

#### å“åº”å‚æ•°
```json
{
  "error": 0,
  "body": {
    "logs": [
      {
        "id": 1,
        "timestamp": "2024-01-20 10:30:00",
        "level": "INFO",
        "module": "UserManagement",
        "operation": "ç”¨æˆ·ç™»å½•",
        "user_id": 1,
        "username": "admin",
        "ip_address": "192.168.1.100",
        "details": "ç”¨æˆ· admin æˆåŠŸç™»å½•ç³»ç»Ÿ",
        "result": "æˆåŠŸ"
      }
    ],
    "total": 1000,
    "page": 1,
    "page_size": 10
  },
  "message": "è·å–æ—¥å¿—åˆ—è¡¨æˆåŠŸ",
  "success": true
}
```

### 10.2 å¯¼å‡ºæ—¥å¿—

**æ¥å£åç§°ï¼š** å¯¼å‡ºç³»ç»Ÿæ—¥å¿—
**åŠŸèƒ½æè¿°ï¼š** å¯¼å‡ºæŒ‡å®šæ¡ä»¶çš„ç³»ç»Ÿæ—¥å¿—ä¸ºæ–‡ä»¶
**æ¥å£åœ°å€ï¼š** /api/logs/export
**è¯·æ±‚æ–¹å¼ï¼š** GET

## 11. WebSocketå®æ—¶é€šä¿¡

### 11.1 å®æ—¶å‘Šè­¦æ¨é€

**æ¥å£åç§°ï¼š** å®æ—¶å‘Šè­¦WebSocketè¿æ¥
**åŠŸèƒ½æè¿°ï¼š** å»ºç«‹WebSocketè¿æ¥æ¥æ”¶å®æ—¶å‘Šè­¦æ¨é€
**æ¥å£åœ°å€ï¼š** WebSocket: /ws/alerts/{user_id}
**è¯·æ±‚æ–¹å¼ï¼š** WebSocket

#### è¿æ¥å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|--------|
| user_id | int | æ˜¯ | ç”¨æˆ·ID | 1 |
| token | string | æ˜¯ | è®¤è¯ä»¤ç‰Œ(æŸ¥è¯¢å‚æ•°) | eyJhbGciOiJIUzI1NiI... |

#### æ¶ˆæ¯æ ¼å¼
```json
{
  "type": "alert",
  "data": {
    "alert_id": 102,
    "alert_type": "å¼‚å¸¸è¡Œä¸º",
    "device_name": "å‰é—¨æ‘„åƒå¤´",
    "location": "å‰é—¨",
    "confidence": 0.85,
    "timestamp": "2024-01-20 15:45:30",
    "image_url": "/uploads/alerts/alert_102.jpg",
    "video_url": "/api/recordings/102/play"
  }
}
```

### 11.2 è®¾å¤‡çŠ¶æ€æ¨é€

**æ¥å£åç§°ï¼š** è®¾å¤‡çŠ¶æ€WebSocketè¿æ¥
**åŠŸèƒ½æè¿°ï¼š** å»ºç«‹WebSocketè¿æ¥æ¥æ”¶è®¾å¤‡çŠ¶æ€å˜åŒ–æ¨é€
**æ¥å£åœ°å€ï¼š** WebSocket: /ws/device-status/{user_id}
**è¯·æ±‚æ–¹å¼ï¼š** WebSocket

#### æ¶ˆæ¯æ ¼å¼
```json
{
  "type": "device_status",
  "data": {
    "device_id": 1,
    "device_name": "å‰é—¨æ‘„åƒå¤´",
    "old_status": "åœ¨çº¿",
    "new_status": "ç¦»çº¿",
    "timestamp": "2024-01-20 15:45:30"
  }
}
```

## 12. é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|-------|------|----------|
| 0 | æˆåŠŸ | - |
| 1001 | å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼å’Œå¿…å¡«é¡¹ |
| 1002 | è®¤è¯å¤±è´¥ | æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ |
| 1003 | æƒé™ä¸è¶³ | è”ç³»ç®¡ç†å‘˜åˆ†é…ç›¸åº”æƒé™ |
| 2001 | ç”¨æˆ·ä¸å­˜åœ¨ | æ£€æŸ¥ç”¨æˆ·IDæ˜¯å¦æ­£ç¡® |
| 2002 | ç”¨æˆ·åå·²å­˜åœ¨ | ä½¿ç”¨å…¶ä»–ç”¨æˆ·å |
| 2003 | å¯†ç é”™è¯¯ | è¾“å…¥æ­£ç¡®çš„å¯†ç  |
| 2004 | è§’è‰²ä¸å­˜åœ¨ | æ£€æŸ¥è§’è‰²IDæ˜¯å¦æ­£ç¡® |
| 2005 | é»˜è®¤è§’è‰²æ— æ³•åˆ é™¤ | åªèƒ½åˆ é™¤è‡ªå®šä¹‰è§’è‰² |
| 3001 | è®¾å¤‡ä¸å­˜åœ¨ | æ£€æŸ¥è®¾å¤‡IDæ˜¯å¦æ­£ç¡® |
| 3002 | è®¾å¤‡ç¦»çº¿ | æ£€æŸ¥è®¾å¤‡ç½‘ç»œè¿æ¥ |
| 3003 | è®¾å¤‡ç¼–å·å·²å­˜åœ¨ | ä½¿ç”¨å…¶ä»–è®¾å¤‡ç¼–å· |
| 3004 | è®¾å¤‡åè®®é…ç½®é”™è¯¯ | æ£€æŸ¥åè®®å‚æ•°é…ç½® |
| 4001 | ç®—æ³•æ–‡ä»¶æ ¼å¼é”™è¯¯ | ä¸Šä¼ æ­£ç¡®æ ¼å¼çš„ç®—æ³•æ–‡ä»¶ |
| 4002 | ç®—æ³•ä¸‹å‘å¤±è´¥ | æ£€æŸ¥ç›®æ ‡åˆ†æå¡çŠ¶æ€ |
| 4003 | ç®—æ³•æ¨¡å‹æ•°é‡è¶…é™ | æ¯ä¸ªç®—æ³•æœ€å¤šå­˜å‚¨5ä¸ªæ¨¡å‹ |
| 5001 | æŠ¥è­¦äº‹ä»¶ä¸å­˜åœ¨ | æ£€æŸ¥æŠ¥è­¦IDæ˜¯å¦æ­£ç¡® |
| 5002 | å½•åƒæ–‡ä»¶ä¸å­˜åœ¨ | æ£€æŸ¥å½•åƒIDæ˜¯å¦æ­£ç¡® |
| 5003 | è”åŠ¨è§„åˆ™é…ç½®é”™è¯¯ | æ£€æŸ¥è”åŠ¨è§„åˆ™å‚æ•° |
| 6001 | æ–‡ä»¶ä¸Šä¼ å¤±è´¥ | æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œå¤§å°é™åˆ¶ |
| 6002 | ç³»ç»Ÿå‡çº§å¤±è´¥ | æ£€æŸ¥å‡çº§åŒ…å®Œæ•´æ€§ |
| 6003 | å¤‡ä»½åˆ›å»ºå¤±è´¥ | æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³ |
| 7001 | WebSocketè¿æ¥å¤±è´¥ | æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè®¤è¯ä¿¡æ¯ |
| 7002 | æ¨é€æœåŠ¡ä¸å¯ç”¨ | è”ç³»æŠ€æœ¯æ”¯æŒ |
| 9999 | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ |

## 13. è®¤è¯è¯´æ˜

### JWT Token ä½¿ç”¨
æ‰€æœ‰APIè¯·æ±‚ï¼ˆé™¤ç™»å½•æ¥å£å¤–ï¼‰éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWT Tokenï¼š

```http
Authorization: Bearer {token}
```

### Token åˆ·æ–°
Tokené»˜è®¤æœ‰æ•ˆæœŸä¸º24å°æ—¶ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ¥å£åˆ·æ–°ï¼š

**æ¥å£åœ°å€ï¼š** /api/auth/refresh
**è¯·æ±‚æ–¹å¼ï¼š** POST

## 14. é€šç”¨è¯´æ˜

### æ—¶é—´æ ¼å¼
æ‰€æœ‰æ—¶é—´å­—æ®µç»Ÿä¸€ä½¿ç”¨æ ¼å¼ï¼š`YYYY-MM-DD HH:mm:ss`

### åˆ†é¡µå‚æ•°
æ‰€æœ‰åˆ†é¡µæ¥å£ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼š
- `page`: é¡µç ï¼Œä»1å¼€å§‹
- `page_size`: æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10ï¼Œæœ€å¤§100

### æ–‡ä»¶ä¸Šä¼ 
æ–‡ä»¶ä¸Šä¼ æ¥å£ä½¿ç”¨ `multipart/form-data` æ ¼å¼ï¼Œæ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š
- ç®—æ³•æ–‡ä»¶ï¼š.zip, .tar, .gz, .py, .sh, .bin
- å›¾ç‰‡æ–‡ä»¶ï¼š.jpg, .jpeg, .png, .bmp
- åœ°å›¾æ–‡ä»¶ï¼š.png, .jpg, .jpeg, .bmp
- ç³»ç»Ÿæ–‡ä»¶ï¼š.zip, .tar, .gz
- é…ç½®æ–‡ä»¶ï¼š.json, .xml, .xlsx

### WebSocketè¿æ¥
WebSocketè¿æ¥éœ€è¦åœ¨æŸ¥è¯¢å‚æ•°ä¸­æºå¸¦tokenè¿›è¡Œè®¤è¯ï¼š
```
ws://host:port/ws/endpoint?token=your_jwt_token
```

**æ³¨æ„ï¼š** å¦‚æœbodyæ˜¯å¯¹è±¡ï¼Œéœ€è¦åˆ—å‡ºæ‰€æœ‰å­å­—æ®µï¼Œæ ¼å¼ä¸º `body.å­—æ®µå` 