# 告警联动设置 - 测试验证清单

## 🎯 快速测试流程

### 第一步：预案管理测试（5分钟）

#### 1.1 创建预案
```
操作：联动预案 Tab → 点击"新增预案"
输入：
  - 预案名称：测试预案001
  - 分类：基于算法
  - 描述：这是一个测试预案
  
预期：✅ 保存成功，列表中显示新预案
```

#### 1.2 配置规则
```
操作：点击预案的"配置规则"按钮 → 点击"添加规则项"
输入：
  - 规则名称：人员入侵规则
  - 告警类型：选择一个类型
  - 告警等级：等级2（中）
  - 联动动作：广播
  - 延迟执行：0秒
  
预期：✅ 规则项添加成功，显示在列表中
```

#### 1.3 编辑预案
```
操作：点击预案的"编辑"按钮
修改：预案名称改为"测试预案001-已修改"
预期：✅ 保存成功，列表中名称已更新
```

---

### 第二步：应用预案测试（3分钟）

#### 2.1 应用预案到板卡
```
操作：点击预案的"应用"按钮
选择：选择1-2个板卡
预期：✅ 显示"应用成功：X个板卡，失败：0个"
```

#### 2.2 验证应用结果
```
操作：切换到"规则配置"Tab
预期：✅ 看到刚才选择的板卡，规则数量>0
```

---

### 第三步：板卡规则管理测试（3分钟）

#### 3.1 查看板卡规则
```
操作：在"规则配置"Tab，点击某个板卡的"编辑规则"
预期：✅ 显示该板卡的所有规则项
```

#### 3.2 编辑板卡规则
```
操作：点击"添加规则项"
输入：
  - 规则名称：新规则
  - 告警类型：选择类型
  - 告警等级：等级1
  - 联动动作：声光报警
  
预期：✅ 保存成功，规则数量+1
```

---

### 第四步：删除测试（1分钟）

#### 4.1 删除预案
```
操作：点击预案的"删除"按钮 → 确认
预期：✅ 预案从列表中移除
```

---

## 🔍 关键检查点

### 网络请求检查
打开浏览器开发者工具 → Network标签，检查：

| API | 方法 | 状态码 | 检查点 |
|-----|------|--------|--------|
| `/api/linkage/plans` | GET | 200 | 返回预案列表 |
| `/api/linkage/plans` | POST | 200 | 创建预案成功 |
| `/api/linkage/plans/:id` | PUT | 200 | 更新预案成功 |
| `/api/linkage/plans/:id/apply` | POST | 200 | 应用预案成功 |
| `/api/linkage/rules` | GET | 200 | 返回规则列表 |
| `/api/linkage/rules` | POST | 200 | 创建规则成功 |

### 控制台检查
按F12打开控制台，确认：
- ❌ 无红色错误信息
- ❌ 无404 Not Found错误
- ✅ 有"预案列表响应"等调试日志
- ✅ 有"应用预案响应"等调试日志

---

## ⚠️ 常见问题排查

### 问题1：创建预案失败
```
错误信息：trigger_conditions_template is required
原因：数据转换失败
检查：
  1. 是否配置了规则项？
  2. 规则项中是否选择了告警类型和等级？
  3. 查看控制台的请求数据是否正确
```

### 问题2：应用预案失败
```
错误信息：该预案没有配置规则项
原因：预案的rule_items为空
解决：先配置规则，再应用预案
```

### 问题3：板卡规则列表为空
```
原因：还没有应用任何预案到板卡
解决：先创建预案并应用到板卡
```

### 问题4：保存板卡规则后规则数量没变
```
原因：页面没有刷新
解决：手动点击"刷新"按钮，或切换Tab重新加载
```

---

## 📊 测试数据示例

### 预案数据
```json
{
  "plan_name": "人员入侵联动预案",
  "category": "algorithm_based",
  "description": "检测到人员入侵时触发广播和声光报警",
  "rule_items": [
    {
      "name": "人员入侵规则",
      "trigger_condition": {
        "alarm_type": 1,
        "alarm_level": 2
      },
      "linkage_actions": [
        {
          "action_type": "broadcast",
          "action_params": {},
          "delay_seconds": 0
        },
        {
          "action_type": "light_sound",
          "action_params": {},
          "delay_seconds": 5
        }
      ]
    }
  ]
}
```

### 应用预案数据
```json
{
  "target_boards": ["board_001", "board_002"]
}
```

---

## ✅ 测试通过标准

所有以下项目都打勾，即测试通过：

- [ ] 创建预案成功
- [ ] 配置规则成功
- [ ] 编辑预案成功
- [ ] 应用预案成功
- [ ] 查看板卡规则成功
- [ ] 编辑板卡规则成功
- [ ] 删除预案成功
- [ ] 无控制台错误
- [ ] 所有API返回200
- [ ] 数据显示正确

---

## 🎬 测试录屏建议

如果需要演示或记录测试过程：

1. **准备阶段**
   - 清空现有测试数据
   - 打开浏览器开发者工具
   - 准备测试数据

2. **录制内容**
   - 完整的操作流程
   - 网络请求和响应
   - 控制台输出
   - 最终结果展示

3. **关键截图**
   - 预案列表页面
   - 规则配置对话框
   - 应用预案成功提示
   - 板卡规则列表

---

## 📝 测试报告模板

```
测试时间：2025-11-19
测试人员：[姓名]
测试环境：[开发/测试/生产]

测试结果：
✅ 预案管理：通过
✅ 预案应用：通过
✅ 板卡规则：通过
✅ 数据一致性：通过

发现问题：
1. [问题描述]
   - 重现步骤：
   - 预期结果：
   - 实际结果：
   - 截图/日志：

总体评价：
[通过/有问题需修复]
```

---

## 🚀 开始测试

准备好了吗？按照上面的流程开始测试吧！

如有任何问题，请查看：
- `API对齐报告-联动设置.md` - 详细的技术文档
- `API对齐总结.md` - 修复内容总结
- 控制台日志 - 实时调试信息
