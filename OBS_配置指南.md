# OBS Studio 推流配置指南

## 第一步：安装OBS Studio
1. 访问 https://obsproject.com/ 下载最新版本的OBS Studio
2. 安装完成后启动OBS Studio

## 第二步：配置推流设置

### 1. 打开设置
- 点击OBS右下角的"设置"按钮

### 2. 配置推流参数
- 点击左侧"推流"选项
- 服务：选择"自定义..."
- 服务器：输入 `rtmp://localhost:1935/live`
- 推流密钥：
  - 摄像机1：输入 `camera1`
  - 摄像机2：输入 `camera2`

### 3. 配置输出设置
- 点击左侧"输出"选项
- 输出模式：选择"简单"
- 视频比特率：建议设置为 2500 Kbps
- 编码器：使用硬件编码器（如果可用）
- 音频比特率：128

### 4. 配置视频设置
- 点击左侧"视频"选项
- 基础(画布)分辨率：1920x1080
- 输出(缩放)分辨率：1280x720（推荐）
- 缩减过滤器：双线性
- 常用FPS值：30

## 第三步：添加视频源

### 方法一：摄像头/网络摄像头
1. 在"来源"区域点击"+"号
2. 选择"视频捕获设备"
3. 创建新的或选择现有的
4. 选择你的摄像头设备
5. 配置分辨率和帧率

### 方法二：窗口捕获
1. 在"来源"区域点击"+"号
2. 选择"窗口捕获"
3. 选择要捕获的窗口

### 方法三：显示器捕获
1. 在"来源"区域点击"+"号
2. 选择"显示器捕获"
3. 选择要捕获的显示器

## 第四步：开始推流

### 启动流媒体服务器
1. 双击运行 `start-streaming.bat`
2. 等待服务器启动完成，看到以下信息：
   ```
   RTMP服务器已启动:
   - RTMP推流地址: rtmp://localhost:1935/live/
   - HTTP服务地址: http://localhost:8000/
   ```

### 开始推流
1. 在OBS中点击"开始推流"按钮
2. 如果配置正确，状态栏会显示"直播中"
3. 推流成功后，网页端会自动检测到流状态

## 第五步：验证推流效果

### 检查推流状态
1. 打开网页应用
2. 将鼠标悬停在摄像头图标上，应该能看到实时截图预览
3. 点击摄像头图标，应该能看到实时视频播放

### 测试多路推流
如果需要同时推两路流：
1. 可以开启两个OBS实例
2. 分别配置不同的推流密钥（camera1和camera2）
3. 或者使用OBS的场景切换功能

## 常见问题解决

### 1. 推流连接失败
- 检查RTMP服务器是否正常运行
- 确认推流地址和密钥是否正确
- 检查防火墙设置，确保1935端口未被阻止

### 2. 网页端看不到视频
- 等待10-15秒，HLS转换需要一些时间
- 检查浏览器控制台是否有错误信息
- 确认8000端口可以正常访问

### 3. 视频延迟较高
- 在OBS输出设置中启用"低延迟模式"
- 调整关键帧间隔为1秒
- 降低视频比特率

### 4. CPU使用率过高
- 使用硬件编码器（NVENC、AMD VCE等）
- 降低输出分辨率
- 调整编码预设为"ultrafast"

## 高级配置

### 自定义HLS设置
如需修改HLS参数，编辑 `rtmp-server.js` 中的ffmpeg选项：
```javascript
'-hls_time 10',        // 每个片段长度（秒）
'-hls_list_size 6',    // 播放列表中保留的片段数
'-hls_wrap 10',        // 文件名循环数量
```

### 多分辨率推流
可以配置自适应比特率推流：
1. 在OBS输出设置中选择"高级"模式
2. 配置多个编码器
3. 修改服务器配置支持多码率

## 技术支持
- 如遇到问题，请检查OBS日志文件
- 查看RTMP服务器控制台输出
- 确保所有依赖包已正确安装
