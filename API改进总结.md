# Belt 前端 API 改进总结

## 改进概述

根据后端智能监控系统API文档，对 belt 文件夹中的前端 API 调用部分进行了全面改进和完善。

## 主要改进内容

### 1. 录像管理 API (recording.js) ✅
**新增功能:**
- `uploadRecording()` - 单个录像文件上传
- `batchUploadRecordings()` - 批量录像文件上传
- `getStreamUrl()` - 获取录像流地址（用于视频播放）

**修改功能:**
- `getRecordingList()` - 改为POST请求，支持分页参数
- `downloadRecording()` - 更新为正确的API路径

### 2. 实时检测 API (detection.js) ✅
**新增功能:**
- `getRealTimeStatus()` - 获取实时检测状态
- `startDetection()` - 开始实时检测
- `stopDetection()` - 停止实时检测

**保留功能:**
- 视频流获取
- 多路视频流
- 预警信息获取
- PTZ云镜控制

### 3. 日志管理 API (log.js) ✅
**新增功能:**
- `getLogStatistics()` - 获取日志统计信息
- `cleanOldLogs()` - 清理旧日志

**保留功能:**
- 系统日志获取
- 日志导出

### 4. 错误处理机制 (index.js) ✅
**完善错误码处理:**
- 添加了所有标准错误码（1001-9999）的处理
- 每个错误码都有对应的中文提示信息
- 自动处理认证失败、权限不足等常见错误

**更新配置:**
- 修改默认API地址为 `http://localhost:8080`
- 保持与后端API文档一致

### 5. WebSocket 实时通信 (websocket.js) ✅
**全新模块:**
- `WebSocketManager` 类 - WebSocket连接管理
- 自动重连机制
- 连接状态监控
- 消息发送和接收

**支持的实时推送:**
- `connectAlerts()` - 实时告警推送
- `connectDeviceStatus()` - 设备状态变化推送
- `connectInstantAlerts()` - 即时告警推送

### 6. API 文档和使用指南 ✅
**新增文档:**
- `README.md` - 完整的API使用指南
- 包含所有模块的使用示例
- WebSocket连接示例
- 错误处理说明
- 文件上传下载示例

## API 对应关系检查

### 与后端 API 文档对应关系：

| 模块 | 后端API状态 | 前端实现状态 | 说明 |
|------|-------------|--------------|------|
| 用户认证 | ✅ 已实现 | ✅ 完整对应 | 包含登录、刷新、用户信息等 |
| 用户管理 | ❌ 部分实现 | ✅ 完整对应 | 用户CRUD、角色管理 |
| 首页看板 | ✅ 已实现 | ✅ 完整对应 | 数据概览、CAD图层 |
| 设备管理 | ❌ 部分实现 | ✅ 完整对应 | 设备CRUD、协议配置、同步 |
| 算法管理 | ❌ 部分实现 | ✅ 完整对应 | 算法上传、下发、配置 |
| 实时检测 | ✅ 已实现 | ✅ 完整对应 | 视频流、检测控制、PTZ |
| 录像管理 | ❌ 部分实现 | ✅ 完整对应 | 上传、播放、下载、统计 |
| 事件中心 | ❌ 部分实现 | ✅ 完整对应 | 报警处理、联动、推送 |
| 系统管理 | ❌ 部分实现 | ✅ 完整对应 | 配置管理、版本管理 |
| 统计分析 | ❌ 部分实现 | ✅ 完整对应 | 多维度统计、报告导出 |
| 日志管理 | ✅ 已实现 | ✅ 完整对应 | 日志查询、统计、清理 |
| WebSocket | ❌ 未实现 | ✅ 全新实现 | 实时推送、自动重连 |

## 技术特点

### 1. 统一的响应格式处理
- 所有API都按照后端标准格式处理响应
- 自动提取 `body` 中的数据
- 统一的错误处理和消息提示

### 2. 完善的错误处理
- 支持所有API文档定义的错误码
- 智能错误消息提示
- 自动处理认证和权限问题

### 3. 文件处理能力
- 支持单文件和多文件上传
- 自动处理文件下载
- FormData 自动构建

### 4. WebSocket 实时通信
- 自动重连机制
- 连接状态监控
- 类型化消息处理

### 5. TypeScript 友好
- 良好的代码注释
- 清晰的参数说明
- 易于类型推导

## 使用建议

1. **引入方式**: 推荐使用模块化引入
   ```javascript
   import { recordingApi } from '@/api/recording'
   ```

2. **错误处理**: 大部分错误会自动处理，特殊情况可以自定义
   ```javascript
   try {
     await recordingApi.uploadRecording(deviceId, file)
   } catch (error) {
     // 自定义错误处理
   }
   ```

3. **WebSocket 使用**: 记得在组件销毁时断开连接
   ```javascript
   onUnmounted(() => {
     websocketApi.disconnectAll()
   })
   ```

4. **环境配置**: 在 `.env` 文件中配置正确的API地址

## 后续建议

1. **测试**: 建议对所有新增的API进行功能测试
2. **文档**: 可以根据实际使用情况完善API文档
3. **优化**: 可以根据业务需求添加更多便利方法
4. **监控**: 建议添加API调用监控和性能统计